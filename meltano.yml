version: 1
send_anonymous_usage_stats: true
project_id: 699e335d-5053-449a-9609-4dfe16e4da69
plugins:
  extractors:
  - name: tap-sumologic
    namespace: tap_sumologic
    pip_url: -e .
    capabilities:
    - state
    - catalog
    - discover
    settings:
    - name: access_id
      kind: password
    - name: access_key
      kind: password
    - name: start_date
      kind: string
    - name: end_date
      kind: string
    - name: time_zone
      kind: string
    - name: tables
      kind: array
    config:
      start_date: 2022-08-21T00:00:00
      end_date: 2022-08-21T00:05:00
      time_zone: UTC
      tables:
      - table_name: example_table_name
        query: >
          (
          _sourceCategory=widen-kubernetes/wip/wip-api-prod 
          OR _sourceCategory=widen-kubernetes/users/rattail-prod 
          OR _sourceCategory=widen-kubernetes/users/dovetail-prod 
          OR _sourceCategory=widen-kubernetes/dam/dam-*
          )
          
          | json "X-Widen-Context-Mirror-Original-Uri" AS mirror_uri nodrop
          | if (!(isNull(mirror_uri)), true, false) as is_mirror
          | where !(isNull(account_name)) AND !(isNull(user_oauth_app)) AND !(isNull(http_response_status))
          | replace(_sourceCategory, /widen-kubernetes\/dam\/dam-.*/, "widen-kubernetes/dam/dam-*") AS source_category
          | replace(url_without_params, /https:\/\/.*\.(com|edu|org|studio|net|uk)\//, "*/") AS endpoint
          | replace(endpoint, /[\w\-]{36}/, "*") AS endpoint
          | replace(endpoint, /[0-9]{9}/, "*") AS endpoint
          | replace(endpoint, /\/$/, "") AS endpoint
          | replace(endpoint, /search\/.*/, "search/*") AS endpoint
          | replace(endpoint, /categories\/.*/, "categories/*") AS endpoint
          | replace(endpoint, /metadata\/.*\/vocabulary/, "metadata/*/vocabulary") AS endpoint
          | replace(endpoint, /metadata\/\*\/vocabulary\/.*/, "metadata/*/vocabulary/*") AS endpoint
          
          | count by endpoint, api_major_version, http_response_status, http_request_method, account_name, account_id, user_oauth_app, user_oauth_client, source_category, logger_name, is_mirror
  loaders:
  - name: target-jsonl
    variant: andyh1203
    pip_url: target-jsonl
